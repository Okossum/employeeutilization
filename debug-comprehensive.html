<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Utilization Debug Dashboard</title>
    <style>
        body { font-family: monospace; margin: 20px; background-color: #f5f5f5; }
        .debug-section { background: white; margin: 10px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
        .warning { border-left-color: #ffc107; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 5px 0; white-space: pre-wrap; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-ok { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-loading { background-color: #ffc107; }
    </style>
</head>
<body>
    <h1>üîç Employee Utilization Debug Dashboard</h1>
    
    <div class="debug-section">
        <h3>üì° Server Status</h3>
        <div id="server-status">
            <span class="status-indicator status-loading"></span>
            Checking...
        </div>
        <button onclick="checkServer()">Check Server</button>
    </div>

    <div class="debug-section">
        <h3>üîê Authentication Status</h3>
        <div id="auth-status">
            <span class="status-indicator status-loading"></span>
            Checking...
        </div>
        <button onclick="checkAuth()">Check Auth</button>
    </div>

    <div class="debug-section">
        <h3>üóÑÔ∏è Firebase Data</h3>
        <div id="firebase-status">
            <span class="status-indicator status-loading"></span>
            Checking...
        </div>
        <button onclick="checkFirebase()">Check Firebase</button>
    </div>

    <div class="debug-section">
        <h3>‚öõÔ∏è React App Status</h3>
        <div id="react-status">
            <span class="status-indicator status-loading"></span>
            Checking...
        </div>
        <button onclick="checkReact()">Check React</button>
    </div>

    <div class="debug-section">
        <h3>üìä Data Loading Test</h3>
        <div id="data-status">
            <span class="status-indicator status-loading"></span>
            Ready to test
        </div>
        <button onclick="testDataLoading()">Test Data Loading</button>
    </div>

    <div class="debug-section">
        <h3>üîß Debug Logs</h3>
        <div class="log" id="debug-logs">Debug logs will appear here...</div>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>

    <script type="module">
        let logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${message}`);
            updateLogsDisplay();
            console.log(message);
        }
        
        function updateLogsDisplay() {
            document.getElementById('debug-logs').textContent = logs.join('\\n');
        }
        
        function updateStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            const indicator = element.querySelector('.status-indicator');
            indicator.className = 'status-indicator status-' + status;
            element.innerHTML = `<span class="status-indicator status-${status}"></span>${message}`;
        }
        
        window.clearLogs = () => {
            logs = [];
            updateLogsDisplay();
        };
        
        window.checkServer = async () => {
            log('üîç Checking server status...');
            try {
                const response = await fetch('http://localhost:5173/');
                if (response.ok) {
                    updateStatus('server-status', 'ok', 'Server running on port 5173 ‚úÖ');
                    log('‚úÖ Server is responding correctly');
                } else {
                    updateStatus('server-status', 'error', `Server error: ${response.status}`);
                    log(`‚ùå Server returned ${response.status}`);
                }
            } catch (error) {
                updateStatus('server-status', 'error', 'Server not reachable ‚ùå');
                log(`‚ùå Server check failed: ${error.message}`);
            }
        };
        
        window.checkAuth = async () => {
            log('üîç Checking authentication...');
            // This would need to be run within the React app context
            updateStatus('auth-status', 'warning', 'Auth check requires React context');
            log('‚ö†Ô∏è Auth check requires running within React app');
        };
        
        window.checkFirebase = async () => {
            log('üîç Checking Firebase connection...');
            try {
                // Import Firebase modules
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                const { getFirestore, collection, getDocs, query, orderBy, limit } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                const firebaseConfig = {
                    apiKey: "AIzaSyDczsAzylUqlnqUxm5Ld5yKlp4IuDSBbi0",
                    authDomain: "employee-utilization.firebaseapp.com",
                    projectId: "employee-utilization",
                    storageBucket: "employee-utilization.firebasestorage.app",
                    messagingSenderId: "301802878680",
                    appId: "1:301802878680:web:3c77e7e1c9d1c5b5f1a0c4"
                };
                
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                // Test plans collection
                const plansRef = collection(db, 'plans');
                const plansSnapshot = await getDocs(plansRef);
                
                updateStatus('firebase-status', 'ok', `Firebase connected - ${plansSnapshot.size} plans found ‚úÖ`);
                log(`‚úÖ Firebase connection successful: ${plansSnapshot.size} plans`);
                
                // Test entries
                if (plansSnapshot.size > 0) {
                    const latestPlanQuery = query(plansRef, orderBy('createdAt', 'desc'), limit(1));
                    const latestPlanSnapshot = await getDocs(latestPlanQuery);
                    const latestPlan = latestPlanSnapshot.docs[0];
                    
                    const entriesRef = collection(db, 'plans', latestPlan.id, 'entries');
                    const entriesSnapshot = await getDocs(entriesRef);
                    
                    log(`‚úÖ Latest plan has ${entriesSnapshot.size} entries`);
                }
                
            } catch (error) {
                updateStatus('firebase-status', 'error', `Firebase error: ${error.message}`);
                log(`‚ùå Firebase error: ${error.message}`);
            }
        };
        
        window.checkReact = async () => {
            log('üîç Checking React app...');
            try {
                const response = await fetch('http://localhost:5173/einsatzplan/view');
                if (response.ok) {
                    const html = await response.text();
                    const hasReact = html.includes('src="/src/main.tsx"');
                    if (hasReact) {
                        updateStatus('react-status', 'ok', 'React app structure detected ‚úÖ');
                        log('‚úÖ React app structure is correct');
                    } else {
                        updateStatus('react-status', 'error', 'React structure not found');
                        log('‚ùå React structure not found in HTML');
                    }
                } else {
                    updateStatus('react-status', 'error', `React route error: ${response.status}`);
                    log(`‚ùå React route returned ${response.status}`);
                }
            } catch (error) {
                updateStatus('react-status', 'error', `React check failed: ${error.message}`);
                log(`‚ùå React check failed: ${error.message}`);
            }
        };
        
        window.testDataLoading = () => {
            log('üîç Opening data loading test...');
            updateStatus('data-status', 'warning', 'Check browser console and network tab');
            window.open('http://localhost:5173/einsatzplan/view', '_blank');
            log('‚úÖ Opened einsatzplan view in new tab - check browser dev tools');
        };
        
        // Auto-run initial checks
        setTimeout(() => {
            checkServer();
            checkFirebase();
            checkReact();
        }, 1000);
    </script>
</body>
</html>
